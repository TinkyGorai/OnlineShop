{% extends 'base/base.html' %}
{% block content %}

<section class="product-section">
    <div class="container">
        <div class="product-card">
            <!-- Product Images -->
            <aside class="product-gallery">
                <div class="img-big-wrap">
                    {% if product_images %}
                        <img id="mainImage" src="{{ product_images.0.image.url }}" alt="{{ selected_color }}">
                    {% else %}
                        <img id="mainImage" src="/media/default-image.jpg" alt="Default Image">
                    {% endif %}
                </div>

                <div class="thumbs-wrap">
                    {% for image in product_images %}
                        <a href="#" class="item-thumb" onclick="changeMainImage('{{ image.image.url }}')">
                            <img src="{{ image.image.url }}" alt="{{ selected_color }}">
                        </a>
                    {% endfor %}
                </div>
            </aside>

            <!-- Product Details -->
            <main class="product-info">
                <h2>{{product.product_name}}</h2>

                <!-- <div class="rating-wrap">
                    <div class="stars">
                        â˜…â˜…â˜…â˜…â˜† (132 reviews)
                    </div>
                    <small class="orders">âœ” 154 orders</small>
                </div> -->

                <div class="price">Rs {{final_price}}/-</div>
                <p>{{product.product_description}}</p>

                <label>Select Color:</label>
                <select id="colorSelect" onchange="changeColor(this.value)">
                    {% for color in color_variants %}
                        <option value="{{color}}" {% if selected_color == color %}selected{% endif %}>
                            {{ color }}
                        </option>
                    {% endfor %}
                </select>

                <label>Select Size:</label>
                <select id="sizeSelect" onchange="change_price(this.value)">
                    {% for size in size_variants %}
                        <option value="{{ size.size }}" {% if selected_size == size.size %}selected{% endif %}>
                            {{ size.size }}
                        </option>
                    {% endfor %}
                </select>

                <div class="buttons">
                    <button id="rzp-button1" class="btn checkout-btn">Buy Now<i class="fa fa-chevron-right"></i> </button>
                    <a href="{% url 'add_to_cart' product.uid %}?size={{ selected_size }}&color={{ selected_color }}" class="cart-btn">
                        Add to Cart ðŸ›’
                    </a>
                </div>
            </main>
        </div>
    </div>
</section>

<script>
    function changeColor(color) {
        let url = new URL(window.location.href);
        url.searchParams.set('color', color);
        window.location.href = url.toString();
    }

    function change_price(size) {
        let url = new URL(window.location.href);
        url.searchParams.set('size', size);
        window.location.href = url.toString();
    }

    function changeMainImage(imageUrl) {
        document.getElementById("mainImage").src = imageUrl;
    }
</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  var options = {
      "key": "rzp_test_jkmzOPacv3Y99Y", // Enter the Key ID generated from the Dashboard
      "amount": "{{payment}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "Ecomm",
      "description": "Purchase",
      "image": "https://example.com/your_logo",
      "order_id": "{{payment.id}}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response){
          window.location.href=f`http://127.0.0.1:8000/accounts/success/?razorpay_payment_id=${response.razorpay_payment_id}&razorpay_order_id=${response.razorpay_order_id}&razorpay_signature=${response.razorpay_signature}`
      },
      
      "theme": {
          "color": "#3399cc"
      }
  };
  var rzp1 = new Razorpay(options);
  rzp1.on('payment.failed', function (response){
          alert(response.error.code);
          alert(response.error.description);
          alert(response.error.source);
          alert(response.error.step);
          alert(response.error.reason);
          alert(response.error.metadata.order_id);
          alert(response.error.metadata.payment_id);
  });
  document.getElementById('rzp-button1').onclick = function(e){
      rzp1.open();
      e.preventDefault();
  }
  </script>

{% endblock %}
